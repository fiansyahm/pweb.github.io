<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pweb-5</title>
    <style>
        h1 {
            text-align: center
        }
        
        h4 {
            margin: 0px;
        }
        
        .container {
            justify-content: center;
            margin: 50px 50px 50px 50px;
            padding: 20px 50px 50px 50px;
            background-color: #E7E9EB;
        }
        
        .form-group,
        button {
            margin-top: 10px;
        }
        
        .form-control {
            width: 100%;
            height: 30px;
        }
        
        select {
            width: 101%;
            height: 30px;
        }
    </style>
</head>

<body>
    <div class="container">
        <h1>Form Validasi Mahasiswa</h1>
        <form action="" method="get">
            <form>
                <div class="form-group">
                    <label for="nama"><h4>Nama</h4></label><br>
                    <input type="nama" class="form-control" id="nama" placeholder="Muhammad Arifiansyah">
                </div>
                <div class="form-group">
                    <label for="nrp"><h4>Nrp</h4></label><br>
                    <input type="nrp" class="form-control" id="nrp" placeholder="05111940000027">
                </div>
                <div class="form-group">
                    <label for="email"><h4>Email</h4></label><br>
                    <input type="email" class="form-control" id="email" placeholder="fiansyahmm@gmail.com">
                </div>
                <div class="form-group">
                    <label for="alamat"><h4>Alamat</h4></label><br>
                    <input type="alamat" class="form-control" id="alamat" placeholder="Tulungagung">
                </div>
                <!-- opem -->

                <!-- end -->
                <div class="form-group">
                    <label for="starta"><h4>Starta</h4></label><br>
                    <select id="starta" name="starta">
                        <option value="D4">D4</option>
                        <option value="S1">S1</option>
                        <option value="S2">S2</option>
                        <option value="S3">S3</option>
                      </select>
                </div>
                <div class="form-group">
                    <label for="jurusan"><h4>Jurusan</h4></label><br>
                    <select id="jurusan" name="jurusan">
                        <option value="volvo">Volvo XC90</option>
                        <option value="saab">Saab 95</option>
                        <option value="mercedes">Mercedes SLK</option>
                        <option value="audi">Audi TT</option>
                      </select>
                </div>
                <div class="form-group">
                    <label for="status"><h4>Status Vaksin</h4></label><br>
                    <select id="status" name="status">
                        <option value="belumvaksin">Belum Vaksin</option>
                        <option value="dosis1">Dosis 1</option>
                        <option value="dosis2">Dosis 2</option>
                      </select>
                </div>
                <button type="submit" class="btn btn-primary">Submit</button>
            </form>
        </form>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js" integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo" crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js" integrity="sha384-wfSDF2E50Y2D1uUdj0O3uMBJnjuUD4Ih7YwaYd1iqfktj0Uod8GCExl3Og8ifwB6" crossorigin="anonymous"></script>
    <script src="https://code.jquery.com/jquery-3.4.1.js" integrity="sha256-WpOohJOqMqqyKL9FccASB9O0KwACQJpFTUBLTYOVvVU=" crossorigin="anonymous"></script>
    <script>
        $(document).ready(function() {

            $('select[name="province_id"]').on('change', function() {


                // tambahan
                $('select[name="layanan"]').empty();
                $("input[name=nama_layanan").val(null);

                // tambahan
                var jumlahorderku = $("input[name=jumlah_order]").val() * 160;
                // menampilkan hasil nama provinsi ke input id nama_provinsi
                $("#weight1").val(jumlahorderku);
                $("#weight").val(jumlahorderku);

                // membuat variable namaprovinsiku untyk mendapatkan atribut nama provinsi
                var namaprovinsiku = $("#province_id option:selected").attr("namaprovinsi");
                // menampilkan hasil nama provinsi ke input id nama_provinsi
                $("#nama_provinsi").val(namaprovinsiku);
                // kita buat variable provincedid untk menampung data id select province
                //memberikan action ketika select name kota_id di select
                //memberikan action ketika select name kota_id di select
                $('select[name="kota_id"]').on('change', function() {
                    // tambahan
                    $('select[name="layanan"]').empty();
                    $("input[name=nama_layanan").val(null);

                    // membuat variable namakotaku untyk mendapatkan atribut nama kota
                    var namakotaku = $("#kota_id option:selected").attr("namakota");
                    var idkotaku = $("#kota_id option:selected").attr("value");
                    // menampilkan hasil nama provinsi ke input id nama_provinsi
                    $("#nama_kota").val(namakotaku);

                    // Tambahan
                    jQuery.ajax({
                        // url yg di root yang kita buat tadi
                        url: "http://geraisentosa.com/kota/" + idkotaku + "/" + provinceid,
                        // aksion GET, karena kita mau mengambil data
                        type: 'GET',
                        // type data json
                        dataType: 'json',
                        // jika data berhasil di dapat maka kita mau apain nih
                        success: function(data) {
                            // jika tidak ada select dr provinsi maka select kota kososng / empty
                            $("#kode_pos1").val(data["postal_code"]);
                            $("#kode_pos").val(data["postal_code"]);
                        }
                    });



                });
                let provinceid = $(this).val();
                //kita cek jika id di dpatkan maka apa yg akan kita eksekusi
                if (provinceid) {
                    // jika di temukan id nya kita buat eksekusi ajax GET
                    jQuery.ajax({
                        // url yg di root yang kita buat tadi
                        url: "http://geraisentosa.com/kota/" + provinceid,
                        // aksion GET, karena kita mau mengambil data
                        type: 'GET',
                        // type data json
                        dataType: 'json',
                        // jika data berhasil di dapat maka kita mau apain nih
                        success: function(data) {
                            // jika tidak ada select dr provinsi maka select kota kososng / empty
                            $('select[name="kota_id"]').empty();
                            // jika ada kita looping dengan each
                            $.each(data, function(key, value) {
                                // perhtikan dimana kita akan menampilkan data select nya, di sini saya memberi name select kota adalah kota_id
                                $('select[name="kota_id"]').append('<option value="' + value.city_id + '" namakota="' + value.type + ' ' + value.city_name + '">' + value.type + ' ' + value.city_name + '</option>');
                            });
                        }
                    });

                    $('select[name="kurir"]').on('change', function() {

                        //tambahan input nama kurir 
                        var kurirku = $("select[name=kurir]").val();
                        // menampilkan hasil nama provinsi ke input id nama_provinsi
                        $("#nama_kurir").val(kurirku);
                        // ssss

                        $('select[name="layanan"]').on('change', function() {
                            //tambahan input nama kurir 
                            // var layananku = "ja;p";
                            var layananku = $("#layanan option:selected").text();
                            // var layananku = $("input[name=layanan]").val();
                            // menampilkan hasil nama provinsi ke input id nama_provinsi
                            $("#nama_layanan").val(layananku);

                            a = layananku.split('-');
                            $a2 = a[2] * 1;
                            $cucu = $("#namaorder_id option:selected").val() * 1;
                            $cuci = $("input[name=jumlah_order]").val() * 1;
                            $kali = $cucu * $cuci + $a2;
                            $("#Totalan_order1").val($kali);
                            $("#Totalan_order").val($kali);

                            // ssss
                        });


                        // kita buat variable untuk menampung data data dari  inputan
                        // name city_origin di dapat dari input text name city_origin
                        let origin = $("input[name=city_origin]").val();
                        // name kota_id di dapat dari select text name kota_id
                        let destination = $("select[name=kota_id]").val();
                        // name kurir di dapat dari select text name kurir
                        let courier = $("select[name=kurir]").val();
                        // name weight di dapat dari select text name weight
                        let weight = $("input[name=weight]").val();
                        // alert(courier);
                        if (courier) {
                            jQuery.ajax({
                                url: "http://geraisentosa.com/origin=" + origin + "&destination=" + destination + "&weight=" + weight + "&courier=" + courier,
                                type: 'GET',
                                dataType: 'json',
                                success: function(data) {
                                    $('select[name="layanan"]').empty();
                                    // ini untuk looping data result nya
                                    $.each(data, function(key, value) {
                                        // tambahanku
                                        $('select[name="layanan"]').append('<option value="' + key + '">' + 'Pilih Layanan' + '</option>');
                                        // ini looping data layanan misal jne reg, jne oke, jne yes
                                        $.each(value.costs, function(key1, value1) {
                                            // ini untuk looping cost nya masing masing
                                            // silahkan pelajari cara menampilkan data json agar lebi paham
                                            $.each(value1.cost, function(key2, value2) {
                                                $('select[name="layanan"]').append('<option value="' + key + '">' + value1.service + '-' + value1.description + '-' + value2.value + '</option>');
                                            });
                                        });
                                    });

                                }
                            });



                        } else {
                            $('select[name="layanan"]').empty();
                        }

                    });

                } else {
                    $('select[name="kota_id"]').empty();
                }

            });

        });
    </script>
</body>

</html>